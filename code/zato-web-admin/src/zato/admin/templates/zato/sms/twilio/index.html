{% extends "zato/index.html" %}

{% block html_title %}SMS Twilio connections{% endblock %}

{% block "extra_css" %}
    <link rel="stylesheet" type="text/css" href="/static/css/jquery.alerts.css">
    <link rel="stylesheet" type="text/css" href="/static/css/joint.min.css">

    <style>

        #paper {
            width: 100%;
            top: 0;
            left: 0;
        }
    </style>

{% endblock %}

{% block "extra_js" %}

    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/jquery/jquery.tablesorter.min.js"></script>
    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/jquery/jquery.cookie.js"></script>
    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/jquery/jquery.alerts.min.js"></script>

    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/joint/lodash.min.js"></script>
    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/joint/backbone.min.js"></script>
    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/joint/joint.min.js"></script>

    <script nonce="{{ CSP_NONCE }}" type="text/javascript" src="/static/js/common.js"></script>


{% endblock %}

{% block "content" %}
<h2 class="zato">Patterns</h2>

Hello paper
<div id="paper"></div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Create a graph (model)
        var graph = new joint.dia.Graph();

        // Create a paper (view)
        var paper = new joint.dia.Paper({
            el: document.getElementById('paper'),
            model: graph,
            width: "100%",
            gridSize: 10,
            drawGrid: true,
            background: {
                color: 'rgba(0, 0, 0, 0.1)'
            }
        });

        // Create some elements
        var rect = new joint.shapes.standard.Rectangle();
        rect.position(100, 30);
        rect.resize(100, 40);
        rect.attr({
            body: {
                fill: '#3498db',
                stroke: '#2980b9',
                strokeWidth: 2
            },
            label: {
                text: 'Rectangle',
                fill: 'white'
            }
        });

        var circle = new joint.shapes.standard.Circle();
        circle.position(400, 30);
        circle.resize(50, 50);
        circle.attr({
            body: {
                fill: '#e74c3c',
                stroke: '#c0392b',
                strokeWidth: 2
            },
            label: {
                text: 'Circle',
                fill: 'white'
            }
        });

        // Add elements to the graph
        graph.addCells([rect, circle]);

        // Create a link between the two shapes
        var link = new joint.shapes.standard.Link();
        link.source(rect);
        link.target(circle);
        link.attr({
            line: {
                stroke: '#333333',
                strokeWidth: 2
            }
        });

        // Add the link to the graph
        graph.addCell(link);

        // Enable element dragging
        paper.on('element:pointerdown', function(elementView) {
            elementView.model.toFront();
        });

        // Define a custom shape
        joint.shapes.custom = {};
        joint.shapes.custom.MyShape = joint.shapes.standard.Rectangle.extend({
            defaults: joint.util.deepSupplement({
                type: 'custom.MyShape',
                attrs: {
                    body: {
                        fill: '#9b59b6',
                        stroke: '#8e44ad',
                        strokeWidth: 2
                    },
                    label: {
                        text: 'Custom Shape',
                        fill: 'white'
                    }
                }
            }, joint.shapes.standard.Rectangle.prototype.defaults)
        });

        // Create an instance of your custom shape
        var myShape = new joint.shapes.custom.MyShape();
        myShape.position(250, 150);
        myShape.resize(120, 60);

        // Add it to the graph
        graph.addCell(myShape);

        // Save the graph
        function saveGraph() {
            var graphJSON = graph.toJSON();
            localStorage.setItem('savedGraph', JSON.stringify(graphJSON));
            console.log('Graph saved!');
        }

        // Load the graph
        function loadGraph() {
            var savedGraph = localStorage.getItem('savedGraph');
            if (savedGraph) {
                graph.fromJSON(JSON.parse(savedGraph));
                console.log('Graph loaded!');
            } else {
                console.log('No saved graph found!');
            }
        }

        // Handle clicks on elements
        paper.on('element:pointerclick', function(elementView) {
            var element = elementView.model;
            console.log('Element clicked:', element.id);

            // You can highlight the clicked element
            element.attr({
                body: {
                    stroke: '#ffd700',
                    strokeWidth: 4
                }
            });
        });

        // Handle clicks on links
        paper.on('link:pointerclick', function(linkView) {
            var link = linkView.model;
            console.log('Link clicked:', link.id);
        });

    });
</script>

{% endblock %}
